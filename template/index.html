<!-- ... (le code prÃ©cÃ©dent reste inchangÃ© jusqu'Ã  la balise <script> ...) -->

<script>
    // ... (code prÃ©cÃ©dent inchangÃ©) ...

    // CrÃ©er une nouvelle classe
    function createClass() {
        const name = document.getElementById('className').value;
        const description = document.getElementById('classDescription').value;
        const level = document.getElementById('classLevel').value;

        if (!name || !level) {
            showNotification('Veuillez remplir tous les champs obligatoires', 'error');
            return;
        }

        const newClass = {
            id: Date.now(),
            name,
            description,
            level,
            teacherId: currentUser.id,
            students: [],
            createdAt: new Date().toISOString()
        };

        database.classes.push(newClass);
        loadClasses();
        loadManageClassOptions();
        loadChatClasses();

        document.getElementById('className').value = '';
        document.getElementById('classDescription').value = '';
        document.getElementById('classLevel').selectedIndex = 0;

        showNotification('Classe crÃ©Ã©e avec succÃ¨s !', 'success');
    }

    // Ajouter un Ã©tudiant
    function addStudent() {
        const classId = parseInt(document.getElementById('manageClassSelect').value);
        const name = document.getElementById('studentName').value;
        const email = document.getElementById('studentEmail').value;

        if (!classId || !name || !email) {
            showNotification('Veuillez remplir tous les champs', 'error');
            return;
        }

        // GÃ©nÃ©rer un mot de passe alÃ©atoire
        const password = Math.random().toString(36).slice(-8);
        
        const newStudent = {
            id: Date.now(),
            name,
            email,
            password,
            role: 'student'
        };

        // Ajouter Ã  la base de donnÃ©es
        database.users.push(newStudent);
        
        // Ajouter Ã  la classe
        const classIndex = database.classes.findIndex(c => c.id === classId);
        if (classIndex !== -1) {
            database.classes[classIndex].students.push(newStudent.id);
        }

        // Afficher le mot de passe
        const studentItem = document.createElement('div');
        studentItem.className = 'student-item';
        studentItem.innerHTML = `
            <div class="student-info">
                <div class="student-avatar">${name.charAt(0)}</div>
                <div>
                    <strong>${name}</strong>
                    <div>${email}</div>
                </div>
            </div>
            <div class="password-display">Mot de passe: ${password}</div>
        `;
        
        document.getElementById('studentsList').appendChild(studentItem);

        // RÃ©initialiser les champs
        document.getElementById('studentName').value = '';
        document.getElementById('studentEmail').value = '';

        showNotification('Ã‰tudiant ajoutÃ© avec succÃ¨s !', 'success');
    }

    // Charger les classes dans la section "Mes Classes"
    function loadClasses() {
        const classGrid = document.getElementById('classGrid');
        classGrid.innerHTML = '';

        let userClasses = [];
        if (currentUser.role === 'professor') {
            userClasses = database.classes.filter(c => c.teacherId === currentUser.id);
        } else {
            // Pour les Ã©tudiants: trouver les classes oÃ¹ ils sont inscrits
            userClasses = database.classes.filter(c => 
                c.students.includes(currentUser.id)
            );
        }

        userClasses.forEach(classItem => {
            const studentCount = classItem.students?.length || 0;
            
            const classCard = document.createElement('div');
            classCard.className = 'class-card';
            classCard.innerHTML = `
                <div class="class-info">
                    <div class="class-name">${classItem.name}</div>
                    <div class="class-details">${classItem.description || 'Pas de description'}</div>
                    <div class="class-stats">
                        <span>Niveau: ${classItem.level}</span>
                        <span>Ã‰tudiants: ${studentCount}</span>
                    </div>
                    ${currentUser.role === 'professor' ? `
                    <div class="class-actions">
                        <button onclick="openAssignmentModal(${classItem.id})">âž• Devoir</button>
                        <button onclick="manageClass(${classItem.id})">ðŸ‘¥ GÃ©rer</button>
                    </div>
                    ` : ''}
                </div>
            `;
            classGrid.appendChild(classCard);
        });
    }

    // Charger les devoirs
    function loadAssignments() {
        const assignmentsList = document.getElementById('assignmentsList');
        assignmentsList.innerHTML = '';

        let userAssignments = [];
        if (currentUser.role === 'professor') {
            userAssignments = database.assignments.filter(a => 
                a.teacherId === currentUser.id
            );
        } else {
            userAssignments = database.assignments.filter(a => 
                a.classId && database.classes.some(c => 
                    c.id === a.classId && c.students.includes(currentUser.id)
                )
            );
        }

        userAssignments.forEach(assignment => {
            const classItem = database.classes.find(c => c.id === assignment.classId);
            const className = classItem ? classItem.name : 'Classe inconnue';
            
            const assignmentItem = document.createElement('div');
            assignmentItem.className = 'assignment-item';
            assignmentItem.innerHTML = `
                <div class="assignment-title">${assignment.title}</div>
                <div class="assignment-meta">
                    <span>Classe: ${className}</span>
                    <span>Date limite: ${new Date(assignment.dueDate).toLocaleString()}</span>
                </div>
                <div class="assignment-meta">
                    ${assignment.description}
                </div>
                ${currentUser.role === 'student' ? `
                <div class="assignment-actions">
                    <button class="btn-small btn-primary">ðŸ“¤ Soumettre</button>
                </div>
                ` : ''}
            `;
            assignmentsList.appendChild(assignmentItem);
        });
    }

    // Charger les classes pour le chat
    function loadChatClasses() {
        const chatClassSelect = document.getElementById('chatClassSelect');
        chatClassSelect.innerHTML = '<option value="">SÃ©lectionner une classe</option>';

        let userClasses = [];
        if (currentUser.role === 'professor') {
            userClasses = database.classes.filter(c => c.teacherId === currentUser.id);
        } else {
            userClasses = database.classes.filter(c => 
                c.students.includes(currentUser.id)
            );
        }

        userClasses.forEach(classItem => {
            const option = document.createElement('option');
            option.value = classItem.id;
            option.textContent = classItem.name;
            chatClassSelect.appendChild(option);
        });
    }

    // Changer de classe dans le chat
    function switchChatClass() {
        currentChatClass = parseInt(document.getElementById('chatClassSelect').value);
        loadChatMessages();
    }

    // Charger les messages du chat
    function loadChatMessages() {
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = '';

        if (!currentChatClass) {
            chatMessages.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #666;">
                    SÃ©lectionnez une classe pour voir les messages
                </div>
            `;
            return;
        }

        const classMessages = database.messages.filter(m => m.classId === currentChatClass);
        
        if (classMessages.length === 0) {
            chatMessages.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #666;">
                    Aucun message dans cette classe
                </div>
            `;
            return;
        }

        classMessages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.innerHTML = `
                <div class="message-author">${msg.authorName}</div>
                <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString()}</div>
                <div>${msg.content}</div>
            `;
            chatMessages.appendChild(messageDiv);
        });

        // Scroll vers le bas
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Envoyer un message
    function sendMessage() {
        const input = document.getElementById('messageInput');
        const content = input.value.trim();
        
        if (!content || !currentChatClass) return;

        const newMessage = {
            id: Date.now(),
            classId: currentChatClass,
            authorId: currentUser.id,
            authorName: currentUser.name,
            content,
            timestamp: new Date().toISOString()
        };

        database.messages.push(newMessage);
        input.value = '';
        loadChatMessages();
    }

    // GÃ©rer la touche EntrÃ©e
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
            event.preventDefault();
        }
    }

    // Ouvrir la modal de crÃ©ation de devoir
    function openAssignmentModal(classId) {
        document.getElementById('assignmentClass').value = classId;
        document.getElementById('assignmentModal').classList.add('active');
    }

    // CrÃ©er un nouveau devoir
    function createAssignment() {
        const title = document.getElementById('assignmentTitle').value;
        const description = document.getElementById('assignmentDescription').value;
        const classId = parseInt(document.getElementById('assignmentClass').value);
        const dueDate = document.getElementById('assignmentDueDate').value;

        if (!title || !classId || !dueDate) {
            showNotification('Veuillez remplir tous les champs obligatoires', 'error');
            return;
        }

        const newAssignment = {
            id: Date.now(),
            title,
            description,
            classId,
            dueDate,
            teacherId: currentUser.id,
            createdAt: new Date().toISOString()
        };

        database.assignments.push(newAssignment);
        closeModal('assignmentModal');
        loadAssignments();
        
        // RÃ©initialiser le formulaire
        document.getElementById('assignmentTitle').value = '';
        document.getElementById('assignmentDescription').value = '';
        document.getElementById('assignmentClass').selectedIndex = 0;
        document.getElementById('assignmentDueDate').value = '';

        showNotification('Devoir crÃ©Ã© avec succÃ¨s !', 'success');
    }

    // Fermer une modal
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }

    // Afficher une notification
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);
        
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    // GÃ©rer une classe (fonction de dÃ©monstration)
    function manageClass(classId) {
        document.getElementById('manageClassSelect').value = classId;
        loadStudentsForClass();
        showNotification(`Gestion de la classe activÃ©e`, 'success');
    }
</script>
</body>
</html>
